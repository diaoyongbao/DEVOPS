upstream portal-huaian {
    hash $clientRealIp;
    server 172.18.63.96:18210 max_fails=1 fail_timeout=2s;
  }

upstream portal-gnxcl {
    hash $clientRealIp;
    server 172.18.63.96:18080 max_fails=1 fail_timeout=2s;
  }
  
upstream portal-xuzhou {
    hash $clientRealIp;
    server 172.18.63.96:18082 max_fails=1 fail_timeout=2s;
  }
  
upstream portal-nantong {
    hash $clientRealIp;
    server 172.18.63.96:18183 max_fails=1 fail_timeout=2s;
  }
  
upstream portal-wuxi {
    hash $clientRealIp;
    server 172.18.63.96:18185 max_fails=1 fail_timeout=2s;
  }

upstream portal-suzhou {
    hash $clientRealIp;
    server 172.18.63.96:18187 max_fails=1 fail_timeout=2s;
  }

upstream portal-yangzhou {
    hash $clientRealIp;
    server 172.18.63.96:18189 max_fails=1 fail_timeout=2s;
  }

upstream portal-zhenjiang {
    hash $clientRealIp;
    server 172.18.63.96:18191 max_fails=1 fail_timeout=2s;
  }

upstream portal-changzhou {
    hash $clientRealIp;
    server 172.18.63.96:18193 max_fails=1 fail_timeout=2s;
  }

upstream portal-nanjing {
    hash $clientRealIp;
    server 172.18.63.96:18195 max_fails=1 fail_timeout=2s;
  }

upstream portal-lianyungang {
    hash $clientRealIp;
    server 172.18.63.96:18197 max_fails=1 fail_timeout=2s;
  }

upstream portal-jiangbei {
    hash $clientRealIp;
    server 172.18.63.96:18199 max_fails=1 fail_timeout=2s;
  }

upstream portal-jiangyin {
    hash $clientRealIp;
    server 172.18.63.96:18201 max_fails=1 fail_timeout=2s;
  }

upstream portal-yancheng {
    hash $clientRealIp;
    server 172.18.63.96:18277 max_fails=1 fail_timeout=2s;
  }

upstream portal-suqian {
    hash $clientRealIp;
    server 172.18.63.96:18279 max_fails=1 fail_timeout=2s;
  }

upstream portal-taizhou {
    hash $clientRealIp;
    server 172.18.63.96:18281 max_fails=1 fail_timeout=2s;
  }

upstream portal-ksaq {
    hash $clientRealIp;
    server 172.18.63.96:18291 max_fails=1 fail_timeout=2s;
  }

upstream portal-rgzn {
    hash $clientRealIp;
    server 172.18.63.96:18293 max_fails=1 fail_timeout=2s;
  }
  
upstream portal-wlw {
    hash $clientRealIp;
    server 172.18.63.96:18295 max_fails=1 fail_timeout=2s;
  }  
  
upstream portal-gxnhjcl {
    hash $clientRealIp;
    server 172.18.63.96:18297 max_fails=1 fail_timeout=2s;
  }  
  
upstream portal-jnhb {
    hash $clientRealIp;
    server 172.18.63.96:18299 max_fails=1 fail_timeout=2s;
  }

upstream portal-qcjhxlbj {
    hash $clientRealIp;
    server 172.18.63.96:18311 max_fails=1 fail_timeout=2s;
  }

upstream portal-jqrjznzb {
    hash $clientRealIp;
    server 172.18.63.96:18313 max_fails=1 fail_timeout=2s;
  }

server {
    listen       443;
    server_name  huaian.jstec.com.cn;
    server_name  gnxcl.jstec.com.cn;
    server_name  xuzhou.jstec.com.cn;
	server_name  nantong.jstec.com.cn;
	server_name  wuxi.jstec.com.cn;	
	server_name  suzhou.jstec.com.cn;
	server_name  yangzhou.jstec.com.cn;
	server_name  zhenjiang.jstec.com.cn;
	server_name  changzhou.jstec.com.cn;	
	server_name  nanjing.jstec.com.cn;	
	server_name  lianyungang.jstec.com.cn;		
	server_name  jiangbei.jstec.com.cn;	
	server_name  jiangyin.jstec.com.cn;
	server_name  yancheng.jstec.com.cn;	
	server_name  suqian.jstec.com.cn;	
	server_name  taizhou.jstec.com.cn;	
	server_name  ksaq.jstec.com.cn;	
	server_name  rgzn.jstec.com.cn;	
	server_name  wlw.jstec.com.cn;	
	server_name  gxnhjcl.jstec.com.cn;	
	server_name  jnhb.jstec.com.cn;	
	server_name  qcjhxlbj.jstec.com.cn;	
	server_name  jqrjznzb.jstec.com.cn;	

    location /socket.io {
      proxy_redirect          off;
      proxy_buffering off;
      proxy_set_header       Host $host:$server_port;
      proxy_set_header        X-Real-IP $remote_addr;
      proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
      client_max_body_size    10m;
      client_body_buffer_size 128k;
      proxy_connect_timeout   1000;
      proxy_send_timeout      1000;
      proxy_read_timeout      1000;
      proxy_buffer_size       256k;
      proxy_buffers           128 256k;
      proxy_busy_buffers_size 256k;
      proxy_temp_file_write_size 256k;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "Upgrade";
      proxy_pass              http://ws_server;
      break;
    }

    location /goBranch/ {
      rewrite .* http://$goto permanent;
    }

    location / {
      if ($uri = /) {
        rewrite ^/.* /branch permanent;
      }
      proxy_pass              http://portal-$city;
      break;
    }

    location /portal {
      rewrite ^/portal/(.*)$ /$1 break;
      proxy_pass http://web_portal;
    }

    location /goto/ {
      rewrite ^/goto/(.*) https://bcs.jstec.com.cn/$1 permanent;
    }

    location /file/ {
      proxy_pass http://web_bss;
    }
  }
